{% extends "base.html" %}
{% block head %}
    {{ super() }}
{% endblock %}
{% block content %}
    {% include "validation_overlay.html" %}

    <div class="control" id="overlay">
        <div class="box container is-fluid is-fluid-mobile overlay-all">
            <a href="javascript:void(0)" class="delete is-large is-pulled-right" onclick="closeOverlay()">&times;</a>
            <div class="box overlay-content has-margin-bottom-12 has-no-padding-bottom has-no-margin-bottom"
                 id="overlay-content">
                <canvas id="myChart"></canvas>
            </div>
            <br/>
            <div class="overlay-managebox columns is-multiline is-centered has-no-margin-top has-no-padding-top"
                 id="overlay-managebox">
                <div class="column is-full has-no-padding-left">
                    <div class="columns is-multiline has-no-margin-left">
                        <div class="column is-one-third-widescreen is-one-third-fullhd is-full-touch is-full-desktop">
                            <div class="columns is-multiline">
                                <div class="column is-pulled-left is-half is-full-touch is-pulled-left has-no-padding-bottom">
                                    <label class="form-group has-float-label">
                                        <input class="input" type="number" id="x-val" placeholder="" size="4"
                                               value="15"
                                               required min="0.0" step="1"><span>X-value</span></label>
                                </div>
                                <div class="column is-pulled-left is-half is-full-touch is-pulled-left has-no-padding-bottom">
                                    <label class="form-group has-float-label">
                                        <input class="input" type="number" id="y-val" placeholder="" size="4"
                                               value="15"
                                               required min="0.0" step="1"><span>Y-value</span></label>
                                </div>
                            </div>
                        </div>
                        <div class="column is-one-third-widescreen is-one-third-fullhd is-full-touch is-full-desktop">
                            <div class="columns is-multiline has-no-padding-bottom">
                                <div class="column is-pulled-left is-half is-full-touch is-pulled-left has-no-padding-bottom">
                                    <button class="button is-block is-info-deactivated button-fill" type="button"
                                            id="addpoint"
                                            name="addpoint"
                                            onclick="addPoint($('#x-val').val(), $('#y-val').val());return false;"
                                            data-balloon="Modify is based on X-Value!" data-balloon-pos="up"> Add /
                                        Modify point
                                    </button>
                                </div>
                                <div class="column is-pulled-left is-half is-full-touch is-pulled-left has-no-padding-bottom">
                                    <button class="button is-block is-info-deactivated button-fill" type="button"
                                            id="removePoint"
                                            name="removePoint"
                                            onclick="removePoint($('#x-val').val());return false;"
                                            data-balloon="Remove is based on X-Value!" data-balloon-pos="up">Remove
                                        point
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="column is-one-third-widescreen is-one-third-fullhd is-full-touch is-full-desktop">
                            <div class="columns is-multiline has-no-padding-bottom">
                                <div class="column is-pulled-left is-half is-full-touch is-pulled-left has-no-padding-bottom">
                                    <button class="button is-block is-info-deactivated button-fill" type="button"
                                            id="setybeforex"
                                            name="setybeforex"
                                            onclick="setYValueBeforeX($('#x-val').val(), $('#y-val').val());return false;"
                                            data-balloon="Changes all Y-Values of Points with a smaller X-Value"
                                            data-balloon-pos="up">
                                        Set Y-Values &lt; X
                                    </button>
                                </div>
                                <div class="column is-pulled-left is-half is-full-touch is-pulled-left has-no-padding-bottom">
                                    <button class="button is-block is-info-deactivated button-fill" type="button"
                                            id="setyafterx"
                                            name="setyafterx"
                                            onclick="setYValueAfterX($('#x-val').val(), $('#y-val').val());return false;"
                                            data-balloon="Changes all Y-Values of Points with a greater X-Value"
                                            data-balloon-pos="up">
                                        Set Y-Values &gt; X
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-full has-no-padding-left">
                    <div class="columns is-multiline has-no-margin-left">
                        <div class="column is-full is-pulled-left is-full-touch">
                            <div class="columns is-multiline">
                                <div class="column is-one-quarter is-full-touch is-pulled-left has-no-padding-bottom">
                                    <input class="button is-block is-info-deactivated button-fill" type="button"
                                           id="doReset"
                                           name="doReset"
                                           onclick="resetChanges();return false;" value="Reset">
                                </div>
                                <div class="column is-one-quarter is-full-touch is-pulled-left has-no-padding-bottom">
                                    <input class="button is-block is-info-deactivated button-fill" type="button"
                                           id="toogleinterpolation"
                                           name="toogleinterpolation"
                                           onclick="toogleCubicInterpolation();return false;"
                                           value="Use Interpolation">
                                </div>
                                <div class="column is-one-quarter is-full-touch is-pulled-left has-no-padding-bottom">
                                    <input class="button is-block is-info-deactivated button-fill" type="button"
                                           id="toogleDragX"
                                           name="toogleDragX" onclick="toogleDragX();return false;"
                                           value="Allow drag along X-Axis">
                                </div>
                                <div class="column is-one-quarter is-full-touch is-pulled-left has-no-padding-bottom">
                                    <button class="button is-block button-fill"
                                            id="publish_gerr"
                                            name="publish_gerr"
                                            onclick="saveChart('{{ host }}', '{{ apikey }}', false, true);let callback_func = function (desc) { validateGraphError('{{ host }}',$('#chart-name').data('id'),false, desc) };showValidationOverlay('', callback_func);return false"
                                            data-balloon="Request validation"
                                            data-balloon-pos="up">Publish
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="columns is-multiline has-no-margin-left">
                        <div class="column is-half is-pulled-left is-full-touch has-no-padding-bottom">
                            <div class="columns has-no-padding-bottom">
                                <div class="column is-half is-pulled-left is-full-mobile">
                                    <label class="form-group has-float-label button-fill">
                                        <input class="input" type="text" id="chart-name" placeholder="" size="20"
                                               required><span>Name</span></label>
                                </div>
                                <div class="column is-pulled-left is-full-mobile">
                                    <button class="button is-block is-info-deactivated button-fill" type="button"
                                            id="update-chart"
                                            name="update-chart"
                                            onclick="saveChart('{{ host }}', '{{ apikey }}', false, true);return false;"
                                            data-balloon="Update current Error-Probability Graph"
                                            data-balloon-pos="up">
                                        &nbsp;<i class="fas fa-save"></i>&nbsp;
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="column is-half is-pulled-left is-full-touch has-no-padding-bottom">
                            <div class="columns">
                                <div class="column is-half is-pulled-left is-full-mobile">
                                    <button class="button is-block is-info-deactivated button-fill" type="button"
                                            id="delete-chart"
                                            name="delete-chart"
                                            onclick="deleteChart('{{ host }}', '{{ apikey }}', $('#x-val').val(), $('#y-val').val());return false;"
                                            data-balloon="Delete current Error-Probability Graph"
                                            data-balloon-pos="up">
                                        Delete
                                    </button>
                                </div>
                                <div class="column is-half is-pulled-left is-full-mobile">
                                    <button class="button is-block is-info-deactivated button-fill"
                                            type="button" id="save-chart" name="save-chart"
                                            onclick="saveChart('{{ host }}', '{{ apikey }}', true, true);return false;"
                                            data-balloon="Save Copy" data-balloon-pos="up"
                                            {% if user_id == None %}disabled{% endif %}> Save copy of Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <h2 class="subtitle">
        Your Query:
    </h2>
    <div class="box container is-fluid is-fluid-mobile">
        <form id="submit_sequence" class="is-fluid is-fluid-mobile">
            <div class="is-block-touch columns is-multiline has-no-padding-bottom has-no-margin-bottom">
                <div class="tooltip" data-position="upper">?
                    <span class="tooltiptext">You can upload your Sequence, FASTA-files or configuration by dragging them in here!</span>
                </div>
                <div class="column is-full">
                    <div class="columns">
                        <div class="column is-1 is-hidden">
                            <p style="font-size:12px;">ACGT only</p>
                            <label data-balloon="Limit Alphabet"
                                   data-balloon-pos="right">
                                <input type="checkbox" aria-label="Limit Alphabet to ACGT" id="limitedChars" checked
                                       class="switch is-rounded button-fill no-outline" name="enableall"/>
                                <label for="limitedChars" class="no-outline"></label>
                            </label>
                        </div>
                        <div class="column has-no-padding-bottom">
                            <div class="field">
                                <div class="control">
                                    <label class="form-group has-float-label">
                                        <textarea class="textarea"
                                                  rows="3" id="sequence" name="sequence"
                                                  placeholder="AAACCAGT"
                                                  required></textarea>
                                        <span>Sequence to analyse</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-full has-no-padding-top has-no-padding-bottom">
                    <div class="is-divider" data-content="Error Detection"></div>
                </div>
                <div class="column is-full">
                    <button class="button is-rounded has-margin-bottom-12" onclick="$('#motif_spoiler').toggle();$(this).toggleClass('is-light');return false">Manage Undesired Motifs</button>
                    <!--<input type="checkbox" id="spoiler1"/>
                    <label class="button button-fill" style="white-space: nowrap; display:unset" for="spoiler1">Manage
                        Undesired Motifs</label>-->
                    <div class="box" id="motif_spoiler" style="display: none">
                        <h3>Changes here wont be saved in your profile!</h3>
                        <br/>
                        <div class="columns" style="margin-top: -2.75rem;">
                            <div class="column">
                                <label>
                                    <input type="checkbox" aria-label="Enable all motifs" id="enable_all"
                                           class="switch is-rounded button-fill is-large no-outline is-pulled-left"
                                           name="enable_all" style="display:none;"
                                           onclick="let en = 'enabled'; $('[id^=en]').each(function (e, elem) {
                                            $(elem).prop('checked', $('#enable_all').prop('checked'));});">
                                    <label for="enable_all" class="no-outline is-pulled-left">All</label>
                                </label>
                            </div>
                        </div>
                        <div style="text-align: left">Enabled:</div>
                        <div id="subseq-container">
                            {% for subsequence in usubsequence %}
                                <div class="control" id="subseq_{{ subsequence.id }}">
                                    <table>
                                        <tr>
                                            <td><input type="checkbox"
                                                       class="switch is-large is-rounded button-fill no-outline"
                                                       id="enabled_{{ subsequence.id }}" name="switchRoundedDefault"
                                                       aria-label="Enable Rule"
                                                       value="{{ subsequence.id }}"/>
                                                <label class="no-outline" for="enabled_{{ subsequence.id }}"></label>
                                            </td>
                                            <td style="width:50%"><label class="form-group has-float-label">
                                                <input class="input is-rounded is-grayable" style="width:100%"
                                                       type="text"
                                                       name="sequence"
                                                       aria-label="Sequence"
                                                       id="sequence_{{ subsequence.id }}" placeholder=""
                                                        {% if subsequence.validated %} readonly {% endif %}
                                                       value="{{ subsequence.sequence }}" required>
                                                <span>Sequence</span></label></td>
                                            <td style="width:15%"><label class="form-group has-float-label">
                                                <input class="input is-rounded is-grayable" style="width:100%"
                                                       type="number"
                                                       id="error_prob_{{ subsequence.id }}"
                                                       aria-label="Error Probability"
                                                       name="error_prob" placeholder=""
                                                        {% if subsequence.validated %} readonly {% endif %}
                                                       value="{{ subsequence.error_prob * 100 }}"
                                                       required min="0.0" max="100.0" step="0.01">
                                                <span style="white-space: nowrap;">Error Probability</span></label></td>
                                            <td style="width:30%"><label class="form-group has-float-label">
                                                <input class="input is-rounded is-grayable" style="width:100%"
                                                       type="text"
                                                       name="description"
                                                       aria-label="Description"
                                                       id="description_{{ subsequence.id }}"
                                                       placeholder="No Description"
                                                       size="30"
                                                        {% if subsequence.description != None %}
                                                       value="{{ subsequence.description }}"
                                                        {% endif %} readonly><span>Description</span></label></td>
                                            <!--
                            {% if subsequence.description != None %}
                                Description: {{ subsequence.description }}
                            {% else %}
                                No Description
                            {% endif %}-->
                                            <td><span class="" style="white-space: nowrap;"><label
                                                    class="checkbox">Validated: <input type="checkbox"
                                                                                       id="validated_{{ subsequence.id }}"
                                                                                       value="{{ subsequence.id }}"
                                                                                       aria-label="Validated"
                                                                                       disabled
                                                    {% if subsequence.validated %} checked {% endif %}/></label></span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="column is-full is-full-touch">
                    <div class="columns is-multiline has-no-padding-bottom">
                        <div class="column is-full has-no-padding-bottom">
                            <div class="columns">
                                <div class="column is-2 is-full-mobile is-pulled-left has-no-padding-right">
                                    <label class="form-group has-float-label">
                                        <input class="input is-rounded" type="number" id="gc_window_size"
                                               placeholder=""
                                               size="4"
                                               value="50"
                                               required min="2" step="1"><span>GC Window</span></label>
                                </div>
                                <div class="column is-full-mobile is-expanded field has-addons has-addons-centered">
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth is-2 select is-primary is-rounded">
                                            <label for="gc-dropdown" aria-label="GC-Method"></label><select
                                                class="button-fill" id="gc-dropdown">
                                        </select>
                                        </div>
                                    </div>
                                    <div class="control">
                                        <input class="button is-block button-fill is-rounded" type="button"
                                               id="showOvrly"
                                               name="mybutton"
                                               onclick="let dropdown_select = $('#gc-dropdown option:selected');
                               deserializeDataAndLoadDraw(dropdown_select.data('jsonblob'),
                               dropdown_select.data('type'));showOverlay(dropdown_select.data('validated'),
                               dropdown_select.data('isowner'), dropdown_select.data('id'), dropdown_select.text(),
                               dropdown_select.data('type'), dropdown_select.data('awaits_validation'));"
                                               value="Change GC Probability" style="height: 36px; width: 240px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-full has-no-padding-bottom">
                            <div class="columns">
                                <div class="column is-2 is-full-mobile is-pulled-left has-no-padding-right">
                                    <label class="form-group has-float-label">
                                        <input class="input is-rounded" type="number" id="kmer_window_size"
                                               placeholder=""
                                               size="4"
                                               value="10"
                                               required min="2" step="1"><span>Kmer Window</span></label>
                                </div>
                                <div class="column is-full-mobile is-expanded field has-addons has-addons-centered">
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth is-2 select is-primary is-rounded">
                                            <label for="kmer-dropdown" aria-label="Kmer-Method"></label><select
                                                class="button-fill"
                                                id="kmer-dropdown"></select>
                                        </div>
                                    </div>
                                    <div class="control">
                                        <input class="button is-block button-fill is-rounded" type="button"
                                               id="showOvrly"
                                               name="mybutton"
                                               onclick="let dropdown_select = $('#kmer-dropdown option:selected');
                               deserializeDataAndLoadDraw(dropdown_select.data('jsonblob'),
                               dropdown_select.data('type'));showOverlay(dropdown_select.data('validated'),
                               dropdown_select.data('isowner'), dropdown_select.data('id'), dropdown_select.text(),
                               dropdown_select.data('type'), dropdown_select.data('awaits_validation'));"
                                               value="Change Kmer Probability" style="height: 36px; width: 240px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="column is-full has-no-padding-bottom">
                            <div class="columns">
                                <div class="column is-2 has-no-padding-right">
                                    <p style="font-size:12px">Calculated Error Prob.</p>
                                    <label data-balloon="Use Calculated Error Probabilities" data-balloon-pos="left">
                                        <input type="checkbox" aria-label="Use Calculated Error Probabilities"
                                               id="calcprobs" class="switch is-rounded button-fill no-outline"
                                               name="cprobs" onclick="let adv_con = $('#advancedcontainer'); let inf_con = $('#informationcontainer'); if ($(this).is(':checked')) {
                                    let seq  = $('#classic_seqmeth');
                                    let synth = $('#classic_synthmeth');
                                    seq.data('selected', $('#classic_seqmeth option:selected').val());
                                    synth.data('selected', $('#classic_synthmeth option:selected').val());
                                    seq.val(0).prop('disabled', true);
                                    synth.val(0).prop('disabled', true);
                                    adv_con.hide();
                                    inf_con.show();
                                } else if ($(this).not(':checked')){
                                    let seq  = $('#classic_seqmeth');
                                    let synth = $('#classic_synthmeth');
                                    seq.val(0).prop('disabled', false);
                                    synth.val(0).prop('disabled', false);
                                    seq.find('option[value='+ seq.data('selected') + ']').prop('selected', true);
                                    synth.find('option[value='+ synth.data('selected') + ']').prop('selected', true);
                                    adv_con.show();
                                    inf_con.hide();
                                }">
                                        <label for="calcprobs" style="" class="no-outline"></label>
                                    </label>
                                </div>
                                <div class="column is-full-mobile is-expanded field has-addons has-addons-centered">
                                    <div class="control is-expanded">
                                        <div class="select is-fullwidth is-2 select is-primary is-rounded">
                                            <label for="homopolymer-dropdown"
                                                   aria-label="Homopolymer-Method"></label><select
                                                class="button-fill" id="homopolymer-dropdown">
                                        </select>
                                        </div>
                                    </div>
                                    <div class="control">
                                        <input class="is-rounded button is-block is-info-deactivated button-fill"
                                               type="button"
                                               id="showOvrly"
                                               name="mybutton"
                                               onclick="let dropdown_select = $('#homopolymer-dropdown option:selected');
                               deserializeDataAndLoadDraw(dropdown_select.data('jsonblob'),
                               dropdown_select.data('type'));showOverlay(dropdown_select.data('validated'),
                               dropdown_select.data('isowner'), dropdown_select.data('id'), dropdown_select.text(),
                               dropdown_select.data('type'), dropdown_select.data('awaits_validation'));"
                                               value="Change Homopolymer Prob." style="height: 36px; width: 240px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-full has-no-padding-top has-no-padding-bottom">
                    <div class="is-divider" data-content="Error Simulation"></div>

                </div>
                <div class="column is-full is-full-touch">
                    <div class="columns is-gapless" id="advancedcontainer" style="margin-bottom: 0;">
                        <div class="column is-2 is-full-mobile has-no-padding-right has-no-padding-top "
                             style="margin-top: 1.0rem">
                            <div class="columns is-multiline">
                                <div class="column is-full">
                                    <p style="font-size:12px;">Advanced Error-Simulation Settings</p>
                                    <label data-balloon="Use Advanced Error Simulation Settings"
                                           data-balloon-pos="right">
                                        <input type="checkbox" aria-label="Use Advanced Error Simulation Settings"
                                               id="adv_exec" class="switch is-rounded button-fill no-outline" onclick="
                                    let classic = $('#classic_err_settings');
                                    let adv_exec = $('#adv_err_settings');
                                    if ($(this).is(':checked')) {
                                    classic.hide();
                                    adv_exec.show();
                                    initListsDnD();
                                } else if ($(this).not(':checked')){
                                    classic.show();
                                    adv_exec.hide();
                                }">
                                        <label for="adv_exec" style="" class="no-outline"></label>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div id="classic_err_settings" class="column">
                            <div class="columns is-multiline">
                                <div id="classic_synth" class="column is-full has-no-padding-bottom">
                                    <div class="select is-fullwidth is-primary is-rounded">
                                        <label class="form-group has-float-label" aria-label="Synthesis Method">
                                            <select class="select" id="classic_synthmeth">
                                                <optgroup label="None">
                                                    <option value="0" selected>None</option>
                                                </optgroup>
                                                <optgroup label="Column synthesized oligos">
                                                    <option value="1">MutS</option>
                                                    <option value="2">Consensus shuffle</option>
                                                    <option value="3">ErrASE</option>
                                                    <option value="9">No error correction</option>
                                                </optgroup>
                                                <optgroup label="Microarray based oligo pools">
                                                    <option value="4">Oligo hybridization based</option>
                                                    <option value="5">High-temperature ligation/hybridization based
                                                    </option>
                                                    <option value="6">ErrASE</option>
                                                    <option value="7">Nuclease-based</option>
                                                    <option value="8">NGS-based</option>
                                                    <option value="10">No error correction</option>
                                                </optgroup>
                                                <optgroup label="User defined">
                                                    <option value="11">Error Rates</option>
                                                    <option value="12">Error Attributes</option>
                                                    <option value="13">Rates and Attributes</option>
                                                </optgroup>
                                            </select><span>Synthesis Method</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="column is-two-fifths is-full-mobile has-no-padding-bottom has-no-padding-right">
                                    <div class="field">
                                        <div class="control">
                                            <label class="form-group has-float-label">
                                                <input class="input is-rounded" type=number rows="1" id="cycles"
                                                       value="30" min="1" max="50" step="1"/>
                                                <span>PCR Cycles</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="column is-three-fifths is-full-mobile has-no-padding-bottom">
                                    <div class="select is-fullwidth is-primary is-rounded">
                                        <!-- values 1-7 correspond to the submethod id in the database -->
                                        <!-- I either have to change the database entries for 0, 8 and 9 -->
                                        <!-- or intercept these values before the database request.  -->
                                        <label class="form-group has-float-label" aria-label="PCR Polymerase">
                                            <select class="select" id="classic_pcrmeth">
                                                <option value="0" selected>None</option>
                                                <option value="1">Taq</option>
                                                <option value="2">Pfu</option>
                                                <option value="3">Phusion</option>
                                                <option value="4">Pwo</option>
                                            </select><span>PCR Polymerase</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="column is-two-fifths is-full-mobile has-no-padding-bottom has-no-padding-right">
                                    <div class="field">
                                        <div class="control">
                                            <label class="form-group has-float-label">
                                                <input class="input is-rounded" type=number rows="1" id="months"
                                                       value="24" min="1" step="1"/>
                                                <span>Months of storage to be simulated</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="column is-three-fifths is-full-mobile has-no-padding-bottom">
                                    <div class="select is-fullwidth is-primary is-rounded">
                                        <!-- values 1-7 correspond to the submethod id in the database -->
                                        <!-- I either have to change the database entries for 0, 8 and 9 -->
                                        <!-- or intercept these values before the database request.  -->
                                        <label class="form-group has-float-label" aria-label="Storage">
                                            <select class="select" id="classic_storagemeth">
                                                <option value="0" selected>None</option>
                                                <option value="1">H. sapiens</option>
                                                <option value="2">M. musculus</option>
                                                <option value="3">D. melanogaster</option>
                                                <option value="4">E. coli</option>
                                                <option value="5">S. cerevisiae</option>
                                            </select><span>Storage Host</span>
                                        </label>
                                    </div>
                                </div>

                                <div id="classic_seq" class="column is-full has-no-padding-bottom">
                                    <div class="select is-fullwidth is-primary is-rounded">
                                        <!-- values 1-7 correspond to the submethod id in the database -->
                                        <!-- I either have to change the database entries for 0, 8 and 9 -->
                                        <!-- or intercept these values before the database request.  -->
                                        <label class="form-group has-float-label" aria-label="Sequencing Method">
                                            <select class="select" id="classic_seqmeth">
                                                <optgroup label="None">
                                                    <option value="0" selected>None</option>
                                                </optgroup>
                                                <optgroup label="Illumina">
                                                    <option value="1">Single End</option>
                                                    <option value="2">Paired End</option>
                                                </optgroup>
                                                <optgroup label="PacBio">
                                                    <option value="4">Subread</option>
                                                    <option value="3">CCS</option>
                                                </optgroup>
                                                <optgroup label="Nanopore">
                                                    <option value="5">1D</option>
                                                    <option value="6">2D</option>
                                                </optgroup>
                                                <optgroup label="User defined">
                                                    <option value="7">Error Rates</option>
                                                    <option value="8">Error Attributes</option>
                                                    <option value="9">Rates and Attributes</option>
                                                </optgroup>
                                            </select><span>Sequencing Method</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="adv_err_settings" class="column" style="display: none; position: relative">
                            <div class="columns is-multiline">
                                <div id="adv_synth" class="column is-full-mobile is-half">
                                    <label for="synthmeth"><p>Synthesis Methods</p></label>
                                    <div class="sort_container" id="synthmeth">
                                        <optgroup class="sort_group" id="nonee" label="None">
                                        </optgroup>
                                    </div>
                                </div>
                                <div id="adv_seq" class="column is-full-mobile is-half">
                                    <label for="seqmeth"><p>Sequencing Methods</p></label>
                                    <div class="sort_container" id="seqmeth">
                                        <optgroup class="sort_group" id="nonee" label="None">
                                        </optgroup>
                                    </div>
                                </div>
                                <div id="adv_storage" class="column is-full-mobile is-half">
                                    <label for="storagemeth"><p>Storage Methods</p></label>
                                    <div class="sort_container" id="storagemeth">
                                        <optgroup class="sort_group" id="nonee" label="None">
                                        </optgroup>
                                    </div>
                                </div>
                                <div id="adv_pcr" class="column is-full-mobile is-half">
                                    <label for="pcrmeth"><p>PCR Methods</p></label>
                                    <div class="sort_container" id="pcrmeth">
                                        <optgroup class="sort_group" id="nonee" label="None">
                                        </optgroup>
                                    </div>
                                </div>
                                <div class="column is-full-mobile is-half">
                                    <div class="field">
                                        <div class="control">
                                            <label class="form-group has-float-label">
                                                <input class="input is-rounded" type=number rows="1" id="mon"
                                                       value="1" min="1" step="1"/>
                                                <span>Month (Storage)</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="column is-full-mobile is-half">
                                    <div class="field">
                                        <div class="control">
                                            <label class="form-group has-float-label">
                                                <input class="input is-rounded" type=number rows="1" id="cyc"
                                                       value="1" min="1" step="1"/>
                                                <span>Cycles (PCR)</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div id="adv_exec" class="column is-full-mobile is-full">
                                    <label for="seqmeth1"><p>Execution Order</p></label>
                                    <div class="sort_container" id="seqmeth1">
                                        <optgroup class="sort_group" id="synthesis_sortable" label="Synthesis">
                                        </optgroup>
                                        <optgroup class="sort_group" id="pcr_sortable" label="Storage/PCR">
                                        </optgroup>
                                        <optgroup class="sort_group" id="sequencing_sortable" label="Sequencing">
                                        </optgroup>
                                    </div>
                                </div>
                                <div id="adv_exec_trash" class="column is-full">
                                    <i class="title fas fa-trash" id="trash" aria-hidden="true"></i>
                                </div>
                            </div>
                            <div class="tooltip" data-position="lower">?
                            <span class="tooltiptext">Use drag&amp;drop or doubleclick to add the selected method to the execution order
                                    and drag methods to the trashcan or doubleclick them to delete them from the execution order.</span>
                            </div>
                        </div>
                    </div>
                    <div class="columns is-gapless is-centered" id="informationcontainer">
                        <p style="font-size:12px;color: grey;">Using calculated error probabilities for the
                            simulation.</p>
                    </div>
                </div>
                <div class="column is-full has-no-padding-top has-no-padding-bottom">
                    <div class="is-divider" data-content="Secondary Structure prediction">
                    </div>
                </div>
                <div class="column is-full is-full-touch" style="position: relative">
                    <div class="tooltip" data-position="rnastruct">?
                        <span class="tooltiptext">Calculated by RNAstructure by <a href="http://rna.urmc.rochester.edu/RNAstructure.html" style="color: #ad9843">Mathews lab</a>.</span>
                    </div>
                    <div class="columns is-gapless">
                        <div class="column is-2 is-1-touch is-1-mobile" style="margin-top: -0.5rem">
                            <p style="font-size:12px;">Max. Expect</p>
                            <label data-balloon="Calculate Secondary Structures"
                                   data-balloon-pos="right">
                                <input type="checkbox" aria-label="Calculate Secondary Structures" id="do_max_expect"
                                       checked class="switch is-rounded button-fill no-outline"
                                       name="do_max_expect"
                                       onclick="$('#temperature').prop('disabled',!$(this).is(':checked'))"/>
                                <label for="do_max_expect" class="no-outline"></label>
                            </label>
                        </div>
                        <div class="column">
                            <div class="field">
                                <div class="control">
                                    <label class="form-group has-float-label">
                                        <p class="control has-icons-right">
                                            <input class="input is-rounded" type=number rows="1" id="temperature"
                                                   value="310.15" min="0" step="0.01"/>
                                            <span class="icon is-right">
                                            <i class="fas fa-thermometer-half"></i>
                                        </span>
                                        </p>
                                        <span>Temperature (°K)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-full has-no-padding-top has-no-padding-bottom">
                    <div class="is-divider" data-content="Configuration">
                    </div>
                </div>
            </div>
            <div class="columns has-no-padding-top">
                <div class="column is-rounded">
                    <div class="columns">
                        <div class="column is-full">
                            <div class="field">
                                <div class="control">
                                    <label class="form-group has-float-label">
                                        <input class="input is-rounded" type=number rows="1" id="seed"
                                               placeholder="Random" min="0" step="1"/>
                                        <span>Seed</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-rounded">
                    <button class="button is-rounded button-fill" id="downloadConfig"
                            onclick="download(collectSendData(2, true), 'mesa.json','application/json');return false">
                        Download current config
                    </button>
                </div>
                <div class="column is-rounded">
                    <button class="button is-rounded button-fill" id="uploadConfig"
                            onclick="upload();return false">Upload config/fasta file
                    </button>
                </div>
            </div>
            <br/>


            <div class="columns has-no-padding-top">
                <div class="column is-1 has-no-padding-bottom" id="email_container">
                    <p style="font-size:12px;">Send E-Mail</p>
                    <label data-balloon="{% if user_id == None %}Type in an email address to use this feature{% else %}Send Result via E-Mail{% endif %}"
                           data-balloon-pos="right">
                        <input type="checkbox" aria-label="Send Result to E-Mail instead of waiting for Output"
                               id="send_email"
                               class="switch is-rounded button-fill no-outline" name="send_email"/>
                        <label for="send_email" class="no-outline"></label>
                        <!-- {% if user_id == None %}disabled{% endif %} -->
                    </label>
                </div>
                <div class="column button-fill has-no-padding-bottom">
                    <button class="button is-block is-info-deactivated is-large is-fullwidth"
                            id="submit_seq_btn">Submit
                    </button>
                </div>
            </div>
            <div>
                <label for="emailadd"></label><input class="input" type="email" name="emailadd" id="emailadd"
                                                     placeholder="Email"
                                                     style="display:none;">
            </div>
        </form>
    </div>

    <div id="results" style="display: none">
        <h2 class="subtitle"> Your Results: </h2>
        <div class="box">
            <h3 class="subtitle has-text-black"> Overall: </h3>
            <div class="text_lettering" id="overall"></div>
            <div class="column is-rounded">
                <button class="button is-rounded" id="downloadFastqOr"
                        onclick="download(collectSendFastQ(false), 'mesa.fastq');return false">
                    Download original sequence as FastQ
                </button>
            </div>
        </div>
        <div class="box" id="resultbox">
            <div class="column is-full">
                <input type="checkbox" id="spoiler2"/>
                <label class="button button-fill" style="white-space: nowrap; display:unset" for="spoiler2">Expand
                    Results</label>
                <div class="spoiler">
                    <div class="box" id="subseqbox">
                        <h3 class="subtitle has-text-black"> Subsequences: </h3>
                        <div class="text_lettering" id="subsequences"></div>
                    </div>
                    <div class="box" id="gcbox">
                        <h3 class="subtitle has-text-black"> GC-Content: </h3>
                        <div class="text_lettering" id="gccontent"></div>
                    </div>
                    <div class="box" id="kmerbox">
                        <h3 class="subtitle has-text-black"> Kmer: </h3>
                        <div class="text_lettering" id="kmer"></div>
                    </div>
                    <div class="box" id="hopobox">
                        <h3 class="subtitle has-text-black"> Homopolymers: </h3>
                        <div class="text_lettering" id="homopolymer"></div>
                    </div>
                </div>
            </div>
        </div>
        <h2 class="subtitle"> Result of the Error Simulation: </h2>
        <div class="box">
            <h3 class="subtitle has-text-black"> Fully modified Sequence: </h3>
            <ul class="full_modified_text_lettering" id="mod_seq" style="overflow-x: auto;"></ul>
            <ul id="mod_seq_inf" style="overflow-x: auto;"></ul>
            <div class="column is-rounded">
                <button class="button is-rounded" id="downloadFastqMod"
                        onclick="download(collectSendFastQ(true), 'mesa.fastq');return false">
                    Download fully modified sequence as FastQ
                </button>
            </div>
        </div>
        <h2 class="subtitle maxExpect"> Max. Expect Secondary-Structure Results: </h2>
        <div class="box maxExpect">
            <h3 class="subtitle has-text-black"> Max-Expect dot-Sequence: </h3>
            <ul class="text_lettering" id="dot_seq" style="overflow-x: auto;"></ul>
            <div class="column is-rounded">
                <p>Download as:</p>
                <button class="button is-rounded downloadIMG" id="downloadSVG"
                        onclick="let id = $('#dot_seq').data('id');downloadImg(id, 'svg');return false">
                    SVG-Image
                </button>
                <button class="button is-rounded downloadIMG" id="downloadPS"
                        onclick="let id = $('#dot_seq').data('id');downloadImg(id, 'ps');return false">
                    PS-Image
                </button>
                <button class="button is-rounded downloadIMG" id="downloadPDF"
                        onclick="let id = $('#dot_seq').data('id');downloadImg(id, 'pdf');return false">
                    PDF-Image
                </button>
                <button class="button is-rounded downloadIMG" id="downloadCT"
                        onclick="let id = $('#dot_seq').data('id');downloadImg(id, 'ct');return false">
                    CT-File
                </button>
                <button class="button is-rounded downloadIMG" id="downloadDOT"
                        onclick="let id = $('#dot_seq').data('id');downloadImg(id, 'dot');return false">
                    DOT-File
                </button>
                <button class="button is-rounded downloadIMG" id="downloadPFS"
                        onclick="let id = $('#dot_seq').data('id');downloadImg(id, 'pfs');return false">
                    PFS-Distribution-File
                </button>
            </div>
        </div>

        <div class="box">
            <h3 class="subtitle has-text-black">Share this result:</h3>
            <ul class="share_mosla_link" id="link_to_share"></ul>
        </div>
        <div class="box">
            <h3 class="subtitle has-text-black">Used Seed:</h3>
            <ul class="share_mosla_link" id="used_seed"></ul>
        </div>

    </div>
    <div id="resultsbymail" style="display: none">
        <div class="box">
            <h3 class="subtitle is-centered is-warning has-text-weight-bold">It looks like this might take a while. Dont
                worry, the results will be sent to your E-Mail.</h3>
        </div>
    </div>

{% endblock %}

{% block javascript %}
    {{ super() }}
    {% if config['DEBUG'] or config['TESTING'] %}
        <script src={{ url_for('static',filename='js/jquery.lettering.js') }}></script>
        <script src={{ url_for('static',filename='js/Chart.min.js') }}></script>
        <script src={{ url_for('static',filename='js/chartjs-plugin-dragData.min.js') }}></script>
        <script src={{ url_for('static',filename='js/Sortable.js') }}></script>
        <script src={{ url_for('static',filename='js/error-chart.js') }}></script>
        <script src={{ url_for('static',filename='js/autoscroll.js') }}></script>
        <script src={{ url_for('static',filename='js/ajax-api.js') }}></script>
        <script src={{ url_for('static',filename='js/index.min.js') }}></script>
    {% endif %}

    <script>
        jQuery(document).ready(function () {
            setApikey("{{ host }}", "{{ apikey }}");
            updateDropdown("{{ host }}", "{{ apikey }}", "gc");
            updateDropdown("{{ host }}", "{{ apikey }}", "homopolymer");
            updateDropdown("{{ host }}", "{{ apikey }}", "kmer");
            let callback = undefined;
            {%  if uuid != None %}
                callback = function (data) {
                    return queryServer('{{ uuid }}');
                };
            {% endif %}
            updateSynthDropdown("{{ host }}", "{{ apikey }}", undefined, callback);
            {%  if user_id != None %}
                user_id = {{user_id}};
                setUser(user_id);
            {% endif %}
            $(window).keydown(function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    return false;
                }
            });

            $(document).keyup(function (e) {
                if (e.keyCode === 27) {
                    if ($("#validation_overlay").is(':visible')) {
                        closeValidationOverlay();
                    } else {
                        closeOverlay();
                    }
                }
            });

            let chart = $('#myChart');
            chart.dblclick(function (e) {
                //getting value by pressing on dataset
                curr_chart.data.datasets.forEach(function (dataset) {
                    for (let scaleName in curr_chart.scales) {
                        let scale = curr_chart.scales[scaleName];
                        if (scale.isHorizontal()) {
                            valueX = Math.max(Math.min(round(scale.getValueForPixel(event.offsetX), xRoundingFactor), maximumX), 0);
                        } else {
                            valueY = Math.max(Math.min(round(scale.getValueForPixel(event.offsetY), yRoundingFactor), maximumY), 0);
                        }
                    }
                    curr_chart.data.datasets.forEach(function (dataset) {
                        dataset.data.push({x: valueX, y: valueY});
                    });
                    dataset.data.sort(function (a, b) {
                        return a.x - b.x;
                    });
                });
                removeDuplicatesX();
                curr_chart.update();
            });
            chart.click(function (e) {
                curr_chart.data.datasets.forEach(function (dataset) {
                    for (let scaleName in curr_chart.scales) {
                        let scale = curr_chart.scales[scaleName];
                        if (scale.isHorizontal()) {
                            valueX = Math.max(Math.min(round(scale.getValueForPixel(event.offsetX), xRoundingFactor), maximumX), 0);
                        } else {
                            valueY = Math.max(Math.min(round(scale.getValueForPixel(event.offsetY), yRoundingFactor), maximumY), 0);
                        }
                    }
                    $('#x-val').val(valueX);
                    $('#y-val').val(valueY);
                });
            });

            $("body").click(function (event) {
                if (!$(event.target).closest(".overlay-all,#overlay-managebox,#overlay-content,#showOvrly,#validation_overlay").length) {
                    closeOverlay();
                }
                if (!$(event.target).closest("#mod_seq").length) {
                    let seq = document.getElementById("mod_seq").innerText;
                    document.getElementById("mod_seq_inf").innerHTML = "GC-Content: " + get_gc_con(seq) + "% Tm: " + calc_tm(seq) + "°C Start-Pos: 0 End-Pos: " + seq.length;
                }
                if (!$(event.target).closest("#inner_validation_overlay,.button").length) {
                    $("#validation_overlay").hide();
                }
            });
            $("#mod_seq").on("click", function (e) {
                if (window.getSelection) {
                    let sel = window.getSelection().toString();
                    set_mod_seq_inf(sel);
                }
            });
            $("#send_email").on("click", function (e) {
                let email_txt = $("#emailadd");
                if ($("#send_email").is(":checked") && user_id === "") {
                    email_txt.show();
                } else {

                    email_txt.val("");
                    email_txt.hide();
                }
            });
        });
        $('#seqmeth1').bind('keyup', function (e) {
            if (e.which === 46 || e.which === 8) {
                $('#seqmeth1 :selected').remove();
                // or your stuff here...
            }
        });
        let adv_exec = $('#adv_err_settings');
        adv_exec.show();
        initListsDnD();
        adv_exec.hide();
        //initListsDnD();
        {% if not mail_enabled %}
            $('#email_container').hide();
            showWarn("Support for E-Mail disabled &ndash; you wont be able to receive any E-Mails! If you are logged in you will see all finished simulations in your profile.", "warning", "500");
        {% endif %}
    </script>
{% endblock %}